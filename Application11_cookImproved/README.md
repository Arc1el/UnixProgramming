# cookImproved

<h3>요구사항</h3>

응용 #10의 경우 한번 조리가 시작되면 다음 주문을 못 받는 상황임.
조리가 시작된 후에도 주문을 계속 받아 조리를 할 수 있도록 개선

SIGALARM을 받기 전에 alarm(0) 을 하는 경우 남은 시간(초 단위)이 반환됨.
Linked list를 이용하여 각 요리의 남은 시간들을 관리
 
시그널 무시 또는 블록킹 방식 선택 자유 !

<h3>구현</h3>

이 프로그램은 응용과제 10번의 주문을 보내고 받아오는 사이에 중복으로 여러번 주문을 보낼수 없는 것을 해결한 프로그램입니다.

또한 메뉴를 선택하여 서로다른 메뉴를 주문할 수 있습니다.

부모에서 pause를 사용하여 자식에게 sigusr1을 받아오면 동작하던 부분을 삭제하여 부모가 자식에게 요리완성 시그널을 받지 못하여도 연속하여 주문할 수 있도록 하였습니다.

자식프로세스에서 메뉴마다 조리시간이 다르기 때문에 상수로 각각 2가지의 조리시간을 정해주었습니다.

그리고 부모가 SIGUSR1, SIGUSR2을 kill로 보내는 경우 (다른메뉴를 보내는 경우) 해당 시그널의 sa.handler를 정 해주어 다른메뉴로 동작하도록 처리하였습니다.

연결리스트로 메뉴의 조리시간을 관리해야하기 때문에 구조체로 노드를 선언하고 멤버로 time과 다음 리스트를 가 리킬 포인터 next를 선언해주었습니다.

부모가 시그널을 보내 각각의 핸들러로 동작하게되면 임시저장할 tmp와 이 전을 나타낼 prev, 새로운 리스트인 new를 선언해주었습니다.

malloc을 사용하여 새로운 리스트를 만들어주고 시 간에 조리시간을 할당해줍니다. new에 연결될 다음 포인터는 널입니다.

만약 헤더가 널이면 인터럽트와 시그알람의 처리핸들러를 정해줍니다. 그후 새롭게 만든 new를 헤더로 지정해줍니 다.

헤더가 널이아니면 time 에 alarm0을 넣어주는데 알람시그널을 받기전에 alarm을 호출하기 때문에 남은 초가 저장되게 됩니다.

그후 tmp를 사용하여 new->time의 값을 기존의 연결리스트가 있었으면 그전의 시간에서 현재 새로운 시간을 빼서 할당하도록 합니다.

이렇게하면 연결리스트에 남은 time 값들이 기존에 들어왔던 주문시간 – 현재 새로들어운 주문시간으로 재설정되어

alrm에 매개변수로 들어가므로 alrm시간을 설정할 수 있게됩니다.

현재 조리중인 음식을 출력하기위해서 left_time을 새로 선언하여 사용하였고 alarm핸들러에서는 이미 사용되고있 던 tmp를 사용해주었습니다.

새롭게 선언한 구조체에 헤더를 할당하고 헤더가 널이아닌경우를 루프시킵니다.

all_time 변수를 선언해주어서 누적되어야하는 현재남은 조리시간을 alltime=alltime+lefttime->time으로 할당해주어 서 출력해주었습니다.

이렇게 하지 않으면 리스트에있는 time값이 출력되기 때문에 실제 남은 시간과는 다르게 출 력되기 때문입니다. 나머지부분은 응용10번과 같습니다.

문제점 : 리스트의 말단에 새주문을 받아 시간을 넣기 때문에 이 프로그램에서 피자, 치킨, 피자 이런식으로 주문 을 넣게되면 new->time이 음수값이 되어

주문을 빠르게 넣는경우처럼 시간이 1로 고정되어버립니다. (추후 응용 과제에서 리스트의 중간에 넣는다던지 앞에 넣는다던지 하는 방법으로 해결 예정)
